---
phase: 01-chat-foundation-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - next.config.js
  - tsconfig.json
  - tailwind.config.js
  - app/layout.tsx
  - app/globals.css
  - lib/db/schema.ts
  - lib/db/index.ts
  - drizzle.config.ts
  - .env.local
autonomous: true

must_haves:
  truths:
    - "Project runs with `npm run dev` without errors"
    - "Database connection is established"
    - "Database schema is defined for users, conversations, and messages"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies"
      contains: "next"
    - path: "lib/db/schema.ts"
      provides: "Database schema definitions"
      exports: ["user", "conversation", "message"]
      min_lines: 40
    - path: "lib/db/index.ts"
      provides: "Database client connection"
      exports: ["db"]
  key_links:
    - from: "lib/db/index.ts"
      to: "postgres driver"
      via: "import { drizzle }"
      pattern: "drizzle.*postgres"
    - from: "lib/db/schema.ts"
      to: "drizzle-orm types"
      via: "pgTable imports"
      pattern: "pgTable.*uuid.*text.*timestamp"
---

<objective>
Initialize Next.js project with TypeScript, Tailwind CSS, and Drizzle ORM configured for PostgreSQL. Set up database schema for users, conversations, and messages with proper foreign key relationships.

Purpose: Establish the technical foundation that all other plans depend on - a working Next.js app with database connectivity.

Output: Functional Next.js development server and database schema ready for authentication and chat features.
</objective>

<execution_context>
@/Users/christian.baverstock/.claude/get-shit-done/workflows/execute-plan.md
@/Users/christian.baverstock/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/christian.baverstock/code/ai-chat/.planning/PROJECT.md
@/Users/christian.baverstock/code/ai-chat/.planning/ROADMAP.md
@/Users/christian.baverstock/code/ai-chat/.planning/STATE.md
@/Users/christian.baverstock/code/ai-chat/.planning/phases/01-chat-foundation-authentication/01-CONTEXT.md
@/Users/christian.baverstock/code/ai-chat/.planning/phases/01-chat-foundation-authentication/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Initialize Next.js project with core dependencies</name>
  <files>
package.json
next.config.js
tsconfig.json
tailwind.config.js
postcss.config.js
app/layout.tsx
app/page.tsx
app/globals.css
.env.local
.gitignore
  </files>
  <action>
Create Next.js 16 project with App Router and TypeScript. Install core dependencies from research:

**Core:**
- next@latest, react@latest, react-dom@latest
- typescript, @types/node, @types/react, @types/react-dom

**AI SDK:**
- ai, @ai-sdk/react, @ai-sdk/google (use Google Gemini per user note, not Anthropic)

**Database:**
- drizzle-orm, postgres
- drizzle-kit (dev dependency)

**Authentication:**
- next-auth@beta (v5), bcrypt-ts, @types/bcrypt-ts

**UI & Rendering:**
- tailwindcss, postcss, autoprefixer
- streamdown, shiki

**Radix UI Components:**
- @radix-ui/react-dialog
- @radix-ui/react-collapsible
- @radix-ui/react-scroll-area
- @radix-ui/react-avatar

**Utilities:**
- cmdk (keyboard shortcuts)
- nanoid (ID generation)
- sonner (toast notifications)
- date-fns (timestamp formatting)
- zustand (UI state management)

Configure tailwind.config.js to support Radix UI with CSS variables for theming. Set up root layout with font and basic structure. Add DATABASE_URL placeholder to .env.local (user will provide actual database). Update .gitignore to include .env.local, node_modules, .next.

Use Tailwind v4 syntax and configuration as specified in research.
  </action>
  <verify>
Run `npm install` successfully, then `npm run dev` - server should start on port 3000 without errors. Visit http://localhost:3000 and see Next.js default page.
  </verify>
  <done>
Project dependencies installed, Next.js dev server runs without errors, Tailwind CSS compiles successfully.
  </done>
</task>

<task type="auto">
  <name>Create database schema with user isolation</name>
  <files>
lib/db/schema.ts
lib/db/index.ts
lib/db/migrate.ts
drizzle.config.ts
  </files>
  <action>
Create Drizzle schema following the pattern from research (Pattern 4):

**lib/db/schema.ts:**
Define three tables with proper relationships:

1. `user` table:
   - id: uuid (primary key, default random)
   - email: varchar(64) (unique, not null)
   - password: varchar(64) (nullable - hashed with bcrypt)
   - createdAt: timestamp (default now)

2. `conversation` table:
   - id: uuid (primary key, default random)
   - userId: uuid (foreign key to user.id, not null)
   - title: text (not null)
   - pinned: boolean (default false, not null)
   - createdAt: timestamp (default now, not null)

3. `message` table:
   - id: uuid (primary key, default random)
   - conversationId: uuid (foreign key to conversation.id with CASCADE delete)
   - role: varchar with enum ['user', 'assistant'] (not null)
   - content: text (not null)
   - createdAt: timestamp (default now, not null)

**lib/db/index.ts:**
Create database client using drizzle with postgres driver:
```typescript
import { drizzle } from 'drizzle-orm/postgres-js';
import postgres from 'postgres';
import * as schema from './schema';

const client = postgres(process.env.DATABASE_URL!);
export const db = drizzle(client, { schema });
```

**drizzle.config.ts:**
Configure Drizzle Kit for migrations with PostgreSQL dialect, pointing to lib/db/schema.ts.

**lib/db/migrate.ts:**
Create migration runner script for executing schema changes.

Foreign key constraints ensure user isolation (AUTH-04 requirement) - conversations belong to users, messages belong to conversations.
  </action>
  <verify>
Run `npx drizzle-kit generate` to generate SQL migrations. Check drizzle/ folder contains migration files with CREATE TABLE statements for all three tables with proper foreign keys.
  </verify>
  <done>
Database schema defined with user, conversation, and message tables. Foreign key relationships enforce data isolation. Migration files generated successfully.
  </done>
</task>

</tasks>

<verification>
1. Run `npm install && npm run dev` - server starts without errors
2. Run `npx drizzle-kit generate` - migrations created
3. Check package.json contains all required dependencies from research
4. Verify lib/db/schema.ts exports user, conversation, message tables
5. Verify foreign key relationships exist (userId in conversation, conversationId in message)
</verification>

<success_criteria>
- Next.js development server runs on http://localhost:3000
- All dependencies from research installed and locked in package.json
- Database schema defined with proper TypeScript types
- Migration files generated and ready to apply to database
- Project structure matches research recommendations
</success_criteria>

<output>
After completion, create `.planning/phases/01-chat-foundation-authentication/01-01-SUMMARY.md` documenting:
- Dependencies installed and versions
- Database schema structure and relationships
- Configuration choices made (Tailwind setup, TypeScript config)
- Any deviations from research recommendations with reasoning
</output>
