---
phase: 01-chat-foundation-authentication
plan: 11
type: execute
wave: 1
depends_on: []
files_modified: ["components/sidebar/conversation-sidebar.tsx"]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Sidebar toggle button remains visible when sidebar is collapsed"
    - "User can collapse sidebar and reopen it via button"
  artifacts:
    - path: "components/sidebar/conversation-sidebar.tsx"
      provides: "Toggle button positioned outside conditional rendering"
      pattern: "button.*toggle.*absolute|fixed"
  key_links:
    - from: "toggle button"
      to: "DOM"
      via: "always rendered (not conditionally)"
      pattern: "!isOpen.*toggle"
---

<objective>
Fix sidebar collapse button disappearing when sidebar closes.

Purpose: Toggle button is currently rendered inside conditionally rendered sidebar content. When isOpen=false, entire content block including toggle button is removed from DOM, making sidebar impossible to reopen. Extract toggle button from conditional rendering.

Output: Persistent toggle button that remains visible in collapsed state, allowing users to reopen sidebar.
</objective>

<execution_context>
@/Users/christian.baverstock/.claude/get-shit-done/workflows/execute-plan.md
@/Users/christian.baverstock/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-chat-foundation-authentication/01-UAT.md
@.planning/phases/01-chat-foundation-authentication/01-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Extract toggle button from conditional rendering</name>
  <files>components/sidebar/conversation-sidebar.tsx</files>
  <action>
Restructure conversation-sidebar.tsx to keep toggle button visible when collapsed.

**Current structure (broken):**
```typescript
{isOpen && (
  <div className="...">
    <SidebarHeader />  {/* Contains toggle button */}
    <ConversationList />
    <UserMenu />
  </div>
)}
```

**New structure (working):**
```typescript
{/* Toggle button - always visible */}
<button
  onClick={toggle}
  className={cn(
    "absolute top-4 transition-all duration-200",
    isOpen ? "right-4" : "left-4 z-50"
  )}
  aria-label={isOpen ? "Collapse sidebar" : "Expand sidebar"}
>
  {isOpen ? <ChevronLeft className="h-5 w-5" /> : <ChevronRight className="h-5 w-5" />}
</button>

{/* Sidebar content - conditional */}
{isOpen && (
  <div className="...">
    <SidebarHeader showToggle={false} />  {/* Remove toggle from header */}
    <ConversationList />
    <UserMenu />
  </div>
)}
```

**Changes required:**

1. **Add imports:**
```typescript
import { ChevronLeft, ChevronRight } from 'lucide-react'
import { cn } from '@/lib/utils'
```

2. **Extract toggle button** from conditional block and render it always, positioned absolutely

3. **Update SidebarHeader** to accept optional `showToggle` prop (default true) and conditionally render toggle button. Pass `showToggle={false}` from conversation-sidebar.tsx since toggle is now at parent level.

4. **Position toggle button:**
   - When open (isOpen=true): right-4 (inside sidebar)
   - When closed (isOpen=false): left-4 with z-50 (visible over collapsed sidebar)

5. **Update sidebar container classes** to ensure toggle button has correct positioning context (position: relative on parent)

**Why this works:** Toggle button is always in DOM, just repositions based on isOpen state. When collapsed, button moves to left edge with high z-index, remaining clickable. When open, button is inside sidebar at right edge (standard close button position).

**Alternative considered but rejected:** Keep minimal 48px wide collapsed strip - adds complexity and conflicts with mobile overlay behavior. Absolute positioned button is simpler and standard pattern.
  </action>
  <verify>npm run build && grep -n "ChevronLeft\|ChevronRight" components/sidebar/conversation-sidebar.tsx</verify>
  <done>Toggle button exists outside conditional rendering. Button visible in both open and collapsed states. User can collapse and reopen sidebar via button.</done>
</task>

</tasks>

<verification>
1. Open sidebar - toggle button visible at top right inside sidebar
2. Click toggle to collapse - sidebar width transitions to 0, toggle button moves to left edge and remains visible
3. Click toggle button again - sidebar reopens with smooth animation
4. Test on both desktop and mobile viewports
5. Build passes without TypeScript errors
</verification>

<success_criteria>
- Toggle button always visible (open or collapsed state)
- Button position animates smoothly (right-4 when open, left-4 when closed)
- Sidebar can be collapsed and reopened multiple times
- Works on both desktop and mobile viewports
- No layout shifts or z-index issues
</success_criteria>

<output>
After completion, create `.planning/phases/01-chat-foundation-authentication/01-11-SUMMARY.md`
</output>
