---
phase: 01-chat-foundation-authentication
plan: 06
type: execute
wave: 4
depends_on: ["01-04", "01-05"]
files_modified:
  - app/(chat)/layout.tsx
  - components/sidebar/conversation-sidebar.tsx
  - components/sidebar/conversation-list.tsx
  - components/sidebar/conversation-item.tsx
  - components/sidebar/conversation-search.tsx
  - components/sidebar/sidebar-header.tsx
  - components/ui/collapsible.tsx
  - lib/db/queries.ts
autonomous: true

must_haves:
  truths:
    - "User can view list of past conversations in sidebar"
    - "User can search conversations by name or content"
    - "User can pin important conversations"
    - "Pinned conversations appear at top"
    - "User can collapse sidebar for more chat space"
    - "Sidebar shows conversation title only (minimal)"
  artifacts:
    - path: "components/sidebar/conversation-sidebar.tsx"
      provides: "Main sidebar container with collapsible behavior"
      min_lines: 80
    - path: "components/sidebar/conversation-list.tsx"
      provides: "List of conversations with pinned section"
      min_lines: 60
    - path: "components/sidebar/conversation-item.tsx"
      provides: "Individual conversation with actions"
      min_lines: 100
    - path: "components/sidebar/conversation-search.tsx"
      provides: "Search and filter functionality"
      min_lines: 50
  key_links:
    - from: "components/sidebar/conversation-list.tsx"
      to: "app/(chat)/actions.ts"
      via: "conversation mutations"
      pattern: "deleteConversation|renameConversation|pinConversation"
    - from: "components/sidebar/conversation-search.tsx"
      to: "lib/db/queries.ts"
      via: "search query"
      pattern: "searchConversations"
    - from: "components/sidebar/conversation-sidebar.tsx"
      to: "zustand store"
      via: "sidebar open/closed state"
      pattern: "useSidebarStore"
---

<objective>
Build collapsible sidebar with conversation list, search, pinning, and inline actions. Implement user decisions: pinned + recent organization, search in sidebar header, minimal display, individual actions only.

Purpose: Deliver conversation list (CHAT-06) and search (CHAT-10) with user's specified organization and interaction patterns.

Output: Functional sidebar showing conversations with search, pinning, rename, and delete actions.
</objective>

<execution_context>
@/Users/christian.baverstock/.claude/get-shit-done/workflows/execute-plan.md
@/Users/christian.baverstock/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/christian.baverstock/code/ai-chat/.planning/PROJECT.md
@/Users/christian.baverstock/code/ai-chat/.planning/ROADMAP.md
@/Users/christian.baverstock/code/ai-chat/.planning/phases/01-chat-foundation-authentication/01-CONTEXT.md
@/Users/christian.baverstock/code/ai-chat/.planning/phases/01-chat-foundation-authentication/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Create collapsible sidebar with conversation list</name>
  <files>
app/(chat)/layout.tsx (update with sidebar)
components/sidebar/conversation-sidebar.tsx
components/sidebar/sidebar-header.tsx
components/ui/collapsible.tsx
lib/stores/sidebar-store.ts
  </files>
  <action>
Implement sidebar following user decisions:

**lib/stores/sidebar-store.ts:**
Create Zustand store for sidebar state:
```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface SidebarState {
  isOpen: boolean;
  toggle: () => void;
  open: () => void;
  close: () => void;
}

export const useSidebarStore = create<SidebarState>()(
  persist(
    (set) => ({
      isOpen: true,
      toggle: () => set((state) => ({ isOpen: !state.isOpen })),
      open: () => set({ isOpen: true }),
      close: () => set({ isOpen: false }),
    }),
    { name: 'sidebar-state' }
  )
);
```

Persist sidebar state to localStorage so preference persists across sessions.

**components/ui/collapsible.tsx:**
Wrapper around @radix-ui/react-collapsible with smooth animation.

**components/sidebar/sidebar-header.tsx:**
Header with:
- "New Conversation" button (calls createConversation action)
- Collapse/expand toggle button
- Clean, minimal design

**components/sidebar/conversation-sidebar.tsx:**
Main sidebar component:
- Fixed position on left (desktop) or overlay (mobile)
- Collapsible per user decision: "user can hide/show with button for more chat space"
- Width: 280px when open, 0px (or icon-only) when collapsed
- Smooth transition animation
- Contains: SidebarHeader, ConversationSearch, ConversationList
- Uses Zustand store for open/closed state

**Update app/(chat)/layout.tsx:**
```typescript
import { ConversationSidebar } from '@/components/sidebar/conversation-sidebar';

export default function ChatLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="flex h-screen">
      <ConversationSidebar />
      <main className="flex-1 relative">{children}</main>
    </div>
  );
}
```

Per user decision: "Sidebar + chat area (classic chat app layout)"
  </action>
  <verify>
1. Visit http://localhost:3000 - sidebar appears on left
2. Click collapse button - sidebar hides smoothly
3. Verify chat area expands to fill space
4. Refresh page - sidebar state persists
5. Check "New Conversation" button exists in header
  </verify>
  <done>
Collapsible sidebar created with persistent state, smooth animations, and header with new conversation button. Layout follows user's classic chat app structure.
  </done>
</task>

<task type="auto">
  <name>Implement conversation list with pinned organization</name>
  <files>
components/sidebar/conversation-list.tsx
components/sidebar/conversation-item.tsx
components/chat/rename-conversation-dialog.tsx
lib/db/queries.ts (add searchConversations function)
  </files>
  <action>
Create conversation list following user decisions:

**lib/db/queries.ts addition:**
```typescript
export async function searchConversations(userId: string, query: string) {
  // Search in conversation titles AND message content
  return db.conversation
    .findMany({
      where: {
        userId,
        OR: [
          { title: { contains: query, mode: 'insensitive' } },
          { messages: { some: { content: { contains: query, mode: 'insensitive' } } } },
        ],
      },
      orderBy: [{ pinned: 'desc' }, { createdAt: 'desc' }],
      include: { messages: { take: 1, orderBy: { createdAt: 'desc' } } }, // Last message for preview
    });
}
```

**components/sidebar/conversation-list.tsx:**
List component that:
- Fetches user's conversations via Server Component or client hook
- Groups into two sections per user decision: "Pinned + recent"
  1. Pinned section (if any pinned conversations)
  2. Recent section (all others, chronological)
- Shows empty state per user decision: "Welcome message + sample prompts"
- Renders ConversationItem for each conversation
- Uses ScrollArea for smooth scrolling

Empty state should show:
- Welcome message
- 3-4 sample prompt buttons (e.g., "Help me automate a workflow", "Analyze this data")
- Clicking sample prompt starts new conversation with that message

**components/sidebar/conversation-item.tsx:**
Individual conversation item per user decision: "Conversation title only - minimal, clean list view"

Display:
- Conversation title (truncate if long)
- Active indicator if current conversation
- Actions on hover:
  - Pin/unpin button
  - Rename button (opens rename dialog)
  - Delete button (opens delete dialog from plan 05)

No bulk operations per user decision: "No bulk actions - individual actions only"

Actions use Server Actions from plan 05: pinConversation, renameConversation, deleteConversation.

**components/chat/rename-conversation-dialog.tsx:**
Similar to delete dialog:
- Input field for new title
- Validate 1-100 characters
- Call renameConversation action
- Toast notification on success
  </action>
  <verify>
1. View sidebar - conversations listed with most recent first
2. Pin a conversation - moves to top under "Pinned" section
3. Hover over conversation - actions appear (pin, rename, delete)
4. Check empty state shows when no conversations
5. Verify conversation title truncates if too long
6. Click conversation - navigates to that conversation
  </verify>
  <done>
Conversation list implemented with pinned + recent organization, hover actions, and empty state with sample prompts. Minimal, clean display per user decision.
  </done>
</task>

<task type="auto">
  <name>Add search and filter functionality</name>
  <files>
components/sidebar/conversation-search.tsx
  </files>
  <action>
Implement search per user decision: "Combined with filter controls in sidebar header"

**components/sidebar/conversation-search.tsx:**
Search component with:
- Search input with icon
- Debounced search (300ms) to avoid excessive queries
- Searches both conversation titles AND message content (CHAT-10 requirement)
- Real-time filtering of conversation list
- Clear button when search has value
- Keyboard shortcut: Cmd+K (Mac) or Ctrl+K (Windows) to focus search

Place in sidebar header between title and new conversation button.

Implementation approach:
1. Client component with controlled input
2. useState for search query
3. useEffect with debounce to call searchConversations
4. Update ConversationList to accept filtered results

Per user decision: "Search placement: Combined with filter controls in sidebar header"

Consider adding filter dropdown for future:
- All conversations
- Pinned only
- Last 7 days
- Last 30 days

For Phase 1, implement search only. Filters are discretion - include if time permits, otherwise note in SUMMARY for Phase 2.
  </action>
  <verify>
1. Type in search box - results filter in real-time
2. Search for text that appears in message content - finds conversation
3. Search for conversation title - finds conversation
4. Clear search - all conversations return
5. Test keyboard shortcut Cmd+K - focuses search input
6. Check debouncing works (doesn't query on every keystroke)
  </verify>
  <done>
Search functionality implemented with real-time filtering, debouncing, and keyboard shortcuts. Searches both titles and message content per CHAT-10 requirement.
  </done>
</task>

</tasks>

<verification>
1. View sidebar - shows list of conversations (CHAT-06)
2. Pin conversation - moves to top, stays there across refreshes
3. Search for conversation by title - finds it (CHAT-10)
4. Search for text from a message - finds conversation (CHAT-10)
5. Hover over conversation - actions appear (rename, delete, pin)
6. Rename conversation - title updates in list
7. Delete conversation - confirmation appears, then removed
8. Collapse sidebar - chat area expands
9. New conversation button - creates and navigates to new conversation
10. Empty state appears when no conversations exist
</verification>

<success_criteria>
- User can view list of past conversations in sidebar (CHAT-06)
- User can search conversations by name or content (CHAT-10)
- Pinned conversations appear at top per user decision
- Sidebar is collapsible per user decision
- Conversation list shows title only per user decision
- Individual actions (no bulk operations) per user decision
- Search combined with filter controls in header per user decision
- Professional, clean aesthetic per user requirement
</success_criteria>

<output>
After completion, create `.planning/phases/01-chat-foundation-authentication/01-06-SUMMARY.md` documenting:
- Sidebar layout and behavior
- Search implementation (debouncing, where it searches)
- Pinned organization approach
- Empty state design choices
- Hover action interaction patterns
- Zustand store usage for sidebar state
- Any additional features added (filters, keyboard shortcuts)
</output>
