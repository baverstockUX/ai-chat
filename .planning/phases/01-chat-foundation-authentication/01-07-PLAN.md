---
phase: 01-chat-foundation-authentication
plan: 07
type: execute
wave: 4
depends_on: ["01-06"]
files_modified:
  - components/keyboard-shortcuts/keyboard-handler.tsx
  - components/keyboard-shortcuts/command-palette.tsx
  - app/(chat)/layout.tsx
  - components/chat/chat-interface.tsx
  - components/sidebar/conversation-sidebar.tsx
  - lib/hooks/use-mobile.ts
  - app/globals.css
autonomous: true

must_haves:
  truths:
    - "User can trigger common actions with keyboard shortcuts"
    - "Mobile UI is distinctly different from desktop (not just responsive scaling)"
    - "Keyboard shortcuts work for: new conversation, search, navigate conversations"
    - "Mobile layout adapts for touch interaction"
  artifacts:
    - path: "components/keyboard-shortcuts/keyboard-handler.tsx"
      provides: "Global keyboard shortcut handler"
      min_lines: 80
    - path: "components/keyboard-shortcuts/command-palette.tsx"
      provides: "Cmd+K command palette"
      min_lines: 100
    - path: "lib/hooks/use-mobile.ts"
      provides: "Mobile detection hook"
      exports: ["useMobile"]
  key_links:
    - from: "components/keyboard-shortcuts/keyboard-handler.tsx"
      to: "cmdk library"
      via: "keyboard event handling"
      pattern: "useHotkeys|addEventListener"
    - from: "components/keyboard-shortcuts/command-palette.tsx"
      to: "cmdk"
      via: "Command component"
      pattern: "Command.*Command.Input"
---

<objective>
Implement comprehensive keyboard shortcuts and mobile-optimized UI. Add command palette for power users and adapt layout for mobile devices with touch-first interactions.

Purpose: Deliver keyboard shortcuts per user decision and mobile UI per user decision: "Separate mobile UI - different layouts/interactions for mobile vs desktop"

Output: Keyboard-navigable interface for power users and mobile-optimized UI for touch devices.
</objective>

<execution_context>
@/Users/christian.baverstock/.claude/get-shit-done/workflows/execute-plan.md
@/Users/christian.baverstock/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/christian.baverstock/code/ai-chat/.planning/PROJECT.md
@/Users/christian.baverstock/code/ai-chat/.planning/ROADMAP.md
@/Users/christian.baverstock/code/ai-chat/.planning/phases/01-chat-foundation-authentication/01-CONTEXT.md
@/Users/christian.baverstock/code/ai-chat/.planning/phases/01-chat-foundation-authentication/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Implement keyboard shortcuts and command palette</name>
  <files>
components/keyboard-shortcuts/keyboard-handler.tsx
components/keyboard-shortcuts/command-palette.tsx
app/(chat)/layout.tsx
  </files>
  <action>
Implement comprehensive keyboard shortcuts per user decision: "Comprehensive shortcuts for common actions (new conversation, search, navigate, etc.)"

Use cmdk library per research: "cmdk or react-hotkeys-hook - Handles key combos, platform differences (Cmd vs Ctrl), conflicts, accessibility"

**components/keyboard-shortcuts/keyboard-handler.tsx:**
Global keyboard shortcut handler:

Keyboard shortcuts to implement:
- **Cmd/Ctrl + K**: Open command palette
- **Cmd/Ctrl + N**: New conversation
- **Cmd/Ctrl + F**: Focus search
- **Cmd/Ctrl + B**: Toggle sidebar
- **Cmd/Ctrl + Shift + D**: Delete current conversation (with confirmation)
- **Cmd/Ctrl + R**: Rename current conversation
- **Esc**: Close dialogs, blur input, exit search
- **Arrow Up/Down**: Navigate conversation list
- **Enter**: Open selected conversation

Handle platform differences (Cmd on Mac, Ctrl on Windows/Linux).

**components/keyboard-shortcuts/command-palette.tsx:**
Command palette using cmdk:
- Opens with Cmd/Ctrl + K
- Fuzzy search for actions
- Actions included:
  - "New Conversation" → creates new conversation
  - "Search Conversations" → focuses search
  - "Toggle Sidebar" → collapse/expand sidebar
  - "Delete Conversation" → delete current conversation
  - "Rename Conversation" → rename current conversation
  - "Pin Conversation" → pin/unpin current
  - Recent conversations (quick navigation)
- Visual indicators for keyboard shortcuts
- Accessible (keyboard navigation, screen reader support)

Design: Clean modal with search input, categorized commands, keyboard hints.

**Update app/(chat)/layout.tsx:**
Add KeyboardHandler and CommandPalette providers at layout level.

Per research: "Don't hand-roll keyboard shortcuts - addEventListener + keydown handlers. Use cmdk or react-hotkeys-hook"

Use cmdk's built-in Command component which handles all the complexity.
  </action>
  <verify>
1. Press Cmd+K (Mac) or Ctrl+K (Windows) - command palette opens
2. Type "new" - shows "New Conversation" action
3. Press Cmd+N - creates new conversation
4. Press Cmd+F - focuses search input
5. Press Cmd+B - toggles sidebar
6. Press Esc - closes command palette
7. Check keyboard shortcuts work across different browsers
  </verify>
  <done>
Comprehensive keyboard shortcuts implemented with command palette. Supports common actions, platform differences handled, accessible for power users.
  </done>
</task>

<task type="auto">
  <name>Create mobile-optimized UI</name>
  <files>
lib/hooks/use-mobile.ts
components/sidebar/conversation-sidebar.tsx (mobile variant)
components/chat/chat-interface.tsx (mobile adjustments)
components/chat/message-input.tsx (mobile keyboard handling)
app/globals.css (mobile-specific styles)
  </files>
  <action>
Implement mobile UI per user decision: "Separate mobile UI - different layouts/interactions for mobile vs desktop"

**lib/hooks/use-mobile.ts:**
Mobile detection hook:
```typescript
import { useEffect, useState } from 'react';

export function useMobile() {
  const [isMobile, setIsMobile] = useState(false);

  useEffect(() => {
    const checkMobile = () => {
      setIsMobile(window.innerWidth < 768); // Tailwind md breakpoint
    };

    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  return isMobile;
}
```

**Mobile UI differences:**

1. **Sidebar (components/sidebar/conversation-sidebar.tsx):**
   - Desktop: Fixed sidebar, collapsible to icon-only
   - Mobile: Full-screen overlay, swipe from left to open, tap outside to close
   - Mobile: No collapse button, just close button
   - Mobile: Full width when open (100vw)

2. **Chat Interface (components/chat/chat-interface.tsx):**
   - Mobile: Add header bar with menu button (opens sidebar), conversation title, actions
   - Desktop: No top header (sidebar always visible)
   - Mobile: Adjust padding for smaller screens

3. **Message Input (components/chat/message-input.tsx):**
   - Mobile: Handle virtual keyboard appearance (adjust viewport)
   - Mobile: Larger touch target for send button (min 44x44px)
   - Mobile: Consider "Send" button instead of just icon
   - Desktop: Keep current design

4. **Message Display:**
   - Mobile: Reduce avatar size
   - Mobile: Adjust message padding
   - Mobile: Swipe gesture for message actions (instead of hover)
   - Desktop: Current hover-based actions

5. **Dialogs:**
   - Mobile: Full-screen on very small devices
   - Desktop: Centered modal

**app/globals.css:**
Add mobile-specific styles:
- Prevent zoom on input focus (iOS)
- Handle safe area insets (notches)
- Adjust touch target sizes
- Smooth scrolling for mobile

Per user decision: "Mobile gets distinctly different UI, not just responsive scaling"

Test on actual mobile device or browser devtools mobile emulation.
  </action>
  <verify>
1. Resize browser to mobile width (<768px) - UI adapts
2. Check sidebar becomes full-screen overlay on mobile
3. Verify touch targets are adequate size (44x44px minimum)
4. Test on iOS Safari - no zoom on input focus
5. Check message actions work with tap (not just hover)
6. Verify header appears on mobile with menu button
7. Test virtual keyboard doesn't cover input
  </verify>
  <done>
Mobile UI implemented with distinct layouts and touch-optimized interactions. Sidebar overlay, larger touch targets, mobile header, and proper keyboard handling.
  </done>
</task>

<task type="auto">
  <name>Add logout functionality</name>
  <files>
components/auth/logout-button.tsx
app/(chat)/layout.tsx (add user menu)
  </files>
  <action>
Implement logout functionality for AUTH-05 requirement:

**components/auth/logout-button.tsx:**
Logout button component:
```typescript
'use client';

import { signOut } from 'next-auth/react';
import { useRouter } from 'next/navigation';

export function LogoutButton() {
  const router = useRouter();

  async function handleLogout() {
    await signOut({ redirect: false });
    router.push('/login');
  }

  return (
    <button onClick={handleLogout} className="...">
      Logout
    </button>
  );
}
```

**Add user menu to layout:**
Options for placement:
1. In sidebar header (desktop)
2. In command palette as action
3. In mobile header menu

Suggest: Small user avatar/icon in sidebar footer (desktop) and mobile header menu. Click opens dropdown with:
- User email
- Settings (placeholder)
- Logout button

Keep minimal per user's clean aesthetic preference.
  </action>
  <verify>
1. Click logout button - signs out successfully
2. Verify redirect to /login after logout
3. Check session cleared (can't access protected routes)
4. Login again - session restored
5. Verify logout appears in command palette (Cmd+K, type "logout")
  </verify>
  <done>
Logout functionality implemented with button in user menu and command palette action. AUTH-05 requirement satisfied.
  </done>
</task>

</tasks>

<verification>
1. Test all keyboard shortcuts on Mac and Windows
2. Command palette opens with Cmd/Ctrl+K and shows all actions
3. Resize browser to mobile width - UI adapts distinctly
4. Sidebar becomes overlay on mobile
5. Touch targets are appropriately sized for mobile
6. Virtual keyboard doesn't cover message input on mobile
7. Logout button works and clears session
8. All Phase 1 requirements (CHAT-01 to CHAT-10, AUTH-01 to AUTH-05) are satisfied
</verification>

<success_criteria>
- Comprehensive keyboard shortcuts work for common actions per user decision
- Command palette provides quick access to all actions
- Mobile UI is distinctly different with touch-optimized interactions per user decision
- Sidebar overlay, mobile header, and larger touch targets on mobile
- User can logout (AUTH-05)
- Professional, clean aesthetic maintained across desktop and mobile
</success_criteria>

<output>
After completion, create `.planning/phases/01-chat-foundation-authentication/01-07-SUMMARY.md` documenting:
- Keyboard shortcut mappings
- Command palette features and actions
- Mobile UI differences from desktop
- Touch interaction patterns
- Responsive breakpoints used
- Logout implementation approach
- Any accessibility considerations
</output>
